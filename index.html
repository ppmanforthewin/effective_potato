<!DOCTYPE HTML>
<!--
	Eventually by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>effective-couscous</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="assets/css/main.css" />
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
		<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
	</head>
	<body>

	<html>  
  
<head>  
  
<!--
TERMS OF USE
BY USING THE FOLLOWING CODE, YOU AGREED THAT:
1. THE MATERIALS ARE PROVIDED "AS IS" AND WITHOUT WARRANTIES OF ANY KIND.
2. DO NOT CHANGE ANY OF THE CODE
3. DO NOT REMOVE THE TEXT OF "powered by calculator.net"
4. COPYRIGHT BELONGS TO calculator.net
5. DO NOT REMOVE THE TERMS OF USE
-->
<!--BEGIN OF SCIENTIFIC CALCULATOR CODE-->
<script>
/*****************************************
(C) http://www.calculator.net all right reserved.
*****************************************/
function gObj(obj) {var theObj;if(document.all){if(typeof obj=="string"){return document.all(obj);}else{return obj.style;}}if(document.getElementById){if(typeof obj=="string"){return document.getElementById(obj);}else{return obj.style;}}return null;}function trimAll(sString){while (sString.substring(0,1) == ' '){sString = sString.substring(1, sString.length);}while (sString.substring(sString.length-1, sString.length) == ' '){sString = sString.substring(0,sString.length-1);} return sString;} function showDebugInfo(){}function r(A){if(A=="10x"||A=="log"||A=="ex"||A=="ln"||A=="sin"||A=="asin"||A=="cos"||A=="acos"||A=="tan"||A=="atan"||A=="e"||A=="pi"||A=="n!"||A=="x2"||A=="1/x"||A=="swap"||A=="x3"||A=="3x"||A=="RND"||A=="M-"||A=="qc"||A=="MC"||A=="MR"||A=="MS"||A=="M+"||A=="sqrt"||A=="pc"){func(A)}else{if(A==1||A==2||A==3||A==4||A==5||A==6||A==7||A==8||A==9||A==0){numInput(A)}else{if(A=="pow"||A=="apow"||A=="+"||A=="-"||A=="*"||A=="/"){opt(A)}else{if(A=="("){popen()}else{if(A==")"){pclose()}else{if(A=="EXP"){exp()}else{if(A=="."){if(entered){value=0;digits=1}entered=false;if((decimal==0)&&(value==0)&&(digits==0)){digits=1}if(decimal==0){decimal=1}refresh()}else{if(A=="+/-"){if(exponent){Hj=-Hj}else{value=-value}refresh()}else{if(A=="C"){level=0;exponent=false;value=0;enter();refresh()}else{if(A=="="){enter();while(level>0){evalx()}refresh()}}}}}}}}}}}var totalDigits=12;var pareSize=12;var degreeRadians="degree";var value=0;var memory=0;var level=0;var entered=true;var decimal=0;var fixed=0;var exponent=false;var digits=0;var showValue="0";var isShowValue=true;function stackItem(){this.value=0;this.op=""}function array(A){this[0]=0;for(i=0;i<A;++i){this[i]=0;this[i]=new stackItem()}this.gG=A}uI=new array(pareSize);function push(B,C,A){if(level==pareSize){return false}for(i=level;i>0;--i){uI[i].value=uI[i-1].value;uI[i].op=uI[i-1].op;uI[i].vg=uI[i-1].vg}uI[0].value=B;uI[0].op=C;uI[0].vg=A;++level;return true}function pop(){if(level==0){return false}for(i=0;i<level;++i){uI[i].value=uI[i+1].value;uI[i].op=uI[i+1].op;uI[i].vg=uI[i+1].vg}--level;return true}function format(I){Ve=trimAll((gObj("\x63\x61\x6C\x66\x6F\x6F\x74\x6E\x6F\x74\x65").innerHTML+"").toLowerCase());xE="\x70\x6F\x77\x65\x72\x65\x64\x20\x62\x79\x20\x3C\x61\x20\x68\x72\x65\x66\x3D\x22\x68\x74\x74\x70\x3A\x2F\x2F\x77\x77\x77\x2E\x63\x61\x6C\x63\x75\x6C\x61\x74\x6F\x72\x2E\x6E\x65\x74\x22\x3E\x63\x61\x6C\x63\x75\x6C\x61\x74\x6F\x72\x2E\x6E\x65\x74\x3C\x2F\x61\x3E";if(Ve!=xE){cc="a";return }if(typeof (cc)!="undefined"){return };var E=""+I;if(E.indexOf("N")>=0||(I==2*I&&I==1+I)){return"Error "}var G=E.indexOf("e");if(G>=0){var A=E.substring(G+1,E.length);if(G>11){G=11}E=E.substring(0,G);if(E.indexOf(".")<0){E+="."}else{j=E.length-1;while(j>=0&&E.charAt(j)=="0"){--j}E=E.substring(0,j+1)}E+=" "+A}else{var J=false;if(I<0){I=-I;J=true}var C=Math.floor(I);var K=I-C;var D=totalDigits-(""+C).length-1;if(!entered&&fixed>0){D=fixed}var F=" 1000000000000000000".substring(1,D+2)+"";if((F=="")||(F==" ")){F=1}else{F=parseInt(F)}var B=Math.floor(K*F+0.5);C=Math.floor(Math.floor(I*F+0.5)/F);if(J){E="-"+C}else{E=""+C}var H="00000000000000"+B;H=H.substring(H.length-D,H.length);G=H.length-1;if(entered||fixed==0){while(G>=0&&H.charAt(G)=="0"){--G}H=H.substring(0,G+1)}if(G>=0){E+="."+H}}return E}function refresh(){var A=format(value);if(exponent){if(Hj<0){A+=" "+Hj}else{A+=" +"+Hj}}if(A.indexOf(".")<0&&A!="Error "){if(entered||decimal>0){A+="."}else{A+=" "}}if(""==(""+A)){document.getElementById("sciOutPut").innerHTML="Â "}else{document.getElementById("sciOutPut").innerHTML=A}}function evalx(){if(level==0){return false}op=uI[0].op;Qk=uI[0].value;if(op=="+"){value=parseFloat(Qk)+value}else{if(op=="-"){value=Qk-value}else{if(op=="*"){value=Qk*value}else{if(op=="/"){value=Qk/value}else{if(op=="pow"){value=Math.pow(Qk,value)}else{if(op=="apow"){value=Math.pow(Qk,1/value)}}}}}}pop();if(op=="("){return false}return true}function popen(){enter();if(!push(0,"(",0)){value="NAN"}refresh()}function pclose(){enter();while(evalx()){}refresh()}function opt(A){enter();if(A=="+"||A=="-"){vg=1}else{if(A=="*"||A=="/"){vg=2}else{if(A=="pow"||A=="apow"){vg=3}}}if(level>0&&vg<=uI[0].vg){evalx()}if(!push(value,A,vg)){value="NAN"}refresh()}function enter(){if(exponent){value=value*Math.exp(Hj*Math.LN10)}entered=true;exponent=false;decimal=0;fixed=0}function numInput(A){if(entered){value=0;digits=0;entered=false}if(A==0&&digits==0){refresh();return }if(exponent){if(Hj<0){A=-A}if(digits<3){Hj=Hj*10+A;++digits;refresh()}return }if(value<0){A=-A}if(digits<totalDigits-1){++digits;if(decimal>0){decimal=decimal*10;value=value+(A/decimal);++fixed}else{value=value*10+A}}refresh()}function exp(){if(entered||exponent){return }exponent=true;Hj=0;digits=0;decimal=0;refresh()}function func(D){enter();if(D=="1/x"){value=1/value}if(D=="pc"){value=value/100}if(D=="qc"){value=value/1000}else{if(D=="swap"){var B=value;value=uI[0].value;uI[0].value=B}else{if(D=="n!"){if(value<0||value>200||value!=Math.round(value)){value="NAN"}else{var E=1;var A;for(A=1;A<=value;++A){E*=A}value=E}}else{if(D=="MR"){value=memory}else{if(D=="M+"){memory+=value}else{if(D=="MS"){memory=value}else{if(D=="MC"){memory=0}else{if(D=="M-"){memory-=value}else{if(D=="asin"){if(degreeRadians=="degree"){value=Math.asin(value)*180/Math.PI}else{value=Math.asin(value)}}else{if(D=="acos"){if(degreeRadians=="degree"){value=Math.acos(value)*180/Math.PI}else{value=Math.acos(value)}}else{if(D=="atan"){if(degreeRadians=="degree"){value=Math.atan(value)*180/Math.PI}else{value=Math.atan(value)}}else{if(D=="e^x"){value=Math.exp(value*Math.LN10)}else{if(D=="2^x"){value=Math.exp(value*Math.LN2)}else{if(D=="e^x"){value=Math.exp(value)}else{if(D=="x^2"){value=value*value}else{if(D=="e"){value=Math.E}else{if(D=="ex"){value=Math.pow(Math.E,value)}else{if(D=="10x"){value=Math.pow(10,value)}else{if(D=="x3"){value=value*value*value}else{if(D=="3x"){value=Math.pow(value,1/3)}else{if(D=="x2"){value=value*value}else{if(D=="sin"){if(degreeRadians=="degree"){value=Math.sin(value/180*Math.PI)}else{value=Math.sin(value)}}else{if(D=="cos"){if(degreeRadians=="degree"){var C=(value%360);if(C<0){C=C+360}if(C==90){value=0}else{if(C==270){value=0}else{value=Math.cos(value/180*Math.PI)}}}else{var C=(value*180/Math.PI)%360;if(C<0){C=C+360}if((Math.abs(C-90)<1e-10)||(Math.abs(C-270)<1e-10)){value=0}else{value=Math.cos(value)}}}else{if(D=="tan"){if(degreeRadians=="degree"){value=Math.tan(value/180*Math.PI)}else{value=Math.tan(value)}}else{if(D=="log"){value=Math.log(value)/Math.LN10}else{if(D=="log2"){value=Math.log(value)/Math.LN2}else{if(D=="ln"){value=Math.log(value)}else{if(D=="sqrt"){value=Math.sqrt(value)}else{if(D=="pi"){value=Math.PI}else{if(D=="RND"){value=Math.random()}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}refresh()};
</script>
<style>
#sciout{padding:5px;border-top:1px solid #262626;border-left:1px solid #262626;border-right:2px outset #262626;border-bottom:2px outset #262626;background: #eeeeee;font-family:arial,helvetica,sans-serif;}#sciOutPut{font-size:18px;padding:3px;margin:2px;cursor:text;text-align:right;background-color:#B8C6A3;border:1px solid #87996b;border-radius: 3px;color:#000;}.scifunc{display: inline-block;display: table-cell;vertical-align: middle;text-align:center;width:50px;height:25px;margin:1px;border:1px solid #262626;border-radius: 3px;font-family:arial,helvetica,sans-serif;font-size:16px;font-weight:bold;color:#185290;background-color:#C8D8E8;}.scifunc:active {background-color:#013f7d;color:#ffffff;}.scinm{display: inline-block;display: table-cell;vertical-align: middle;padding: 5px 0px;text-align:center;width:50px;height:30px;margin:1px;border:1px solid #262626;border-radius: 3px;font-family:arial,helvetica,sans-serif;font-size:16px;font-weight:bold;color:#FFF;background-color:#262626;}.scinm:active {background-color:#aaaaaa;color:#000000;}.sciop{display: inline-block;display: table-cell;vertical-align: middle;padding: 5px 0px;text-align:center;width:50px;height:30px;margin:1px;border:1px solid #262626;border-radius: 3px;font-family:arial,helvetica,sans-serif;font-size:16px;font-weight:bold;color:#262626;background-color:#ccc;}.sciop:active {background-color:#000000;color:#ffffff;}.scird{display: inline-block;display: table-cell;vertical-align: middle;text-align:center;height:30px;margin:1px;border:1px solid #eeeeee;border-radius: 3px;font-family:arial,helvetica,sans-serif;font-size:13px;color:#262626;}.scieq{display: inline-block;display: table-cell;vertical-align: middle;padding: 5px 0px;text-align:center;width:50px;height:30px;margin:1px;border:1px solid #262626;border-radius: 3px;font-family:arial,helvetica,sans-serif;font-size:16px;font-weight:bold;color:#F00;background-color:#DCADB0;}.scieq:active {background-color:#ff0000;color:#ffffff;}#calfootnote {font-family:arial,helvetica,sans-serif;font-size:12px;text-align:right;}
</style>
<table><tr><td id="sciout"><div><div id="sciOutPut">0</div></div><div style="padding-top:3px;width:100%"><div><span onclick="r('sin')" class="scifunc">sin</span><span onclick="r('cos')" class="scifunc">cos</span><span onclick="r('tan')" class="scifunc">tan</span><span class="scird"><label for="scirdsettingd"><input id="scirdsettingd" type="radio" name="scirdsetting" value="deg" onClick="degreeRadians='degree';" checked>Deg</label><label for="scirdsettingr"><input id="scirdsettingr" type="radio" name="scirdsetting" value="rad" onClick="degreeRadians='radians';">Rad</label></span></div><div><span onclick="r('asin')" class="scifunc">sin<sup>-1</sup></span><span onclick="r('acos')" class="scifunc">cos<sup>-1</sup></span><span onclick="r('atan')" class="scifunc">tan<sup>-1</sup></span><span onclick="r('pi')" class="scifunc">&#960;</span><span onclick="r('e')" class="scifunc">e</span></div><div><span onclick="r('pow')" class="scifunc">x<sup>y</sup></span><span onclick="r('x3')" class="scifunc">x<sup>3</sup></span><span onclick="r('x2')" class="scifunc">x<sup>2</sup></span><span onclick="r('ex')" class="scifunc">e<sup>x</sup></span><span onclick="r('10x')" class="scifunc">10<sup>x</sup></span></div><div><span onclick="r('apow')" class="scifunc"><sup>y</sup>&#8730;x</span><span onclick="r('3x')" class="scifunc"><sup>3</sup>&#8730;x</span><span onclick="r('sqrt')" class="scifunc">&#8730;x</span><span onclick="r('ln')" class="scifunc">ln</span><span onclick="r('log')" class="scifunc">log</span></div><div><span onclick="r('(')" class="scifunc">(</span><span onclick="r(')')" class="scifunc">)</span><span onclick="r('1/x')" class="scifunc">1/x</span><span onclick="r('pc')" class="scifunc">%</span><span onclick="r('n!')" class="scifunc">n!</span></div></div><div style="padding-top:3px;"><div><span onclick="r(7)" class="scinm">7</span><span onclick="r(8)" class="scinm">8</span><span onclick="r(9)" class="scinm">9</span><span onclick="r('+')" class="sciop">+</span><span onclick="r('MS')" class="sciop">MS</span></div><div><span onclick="r(4)" class="scinm">4</span><span onclick="r(5)" class="scinm">5</span><span onclick="r(6)" class="scinm">6</span><span onclick="r('-')" class="sciop">&ndash;</span><span onclick="r('M+')" class="sciop">M+</span></div><div><span onclick="r(1)" class="scinm">1</span><span onclick="r(2)" class="scinm">2</span><span onclick="r(3)" class="scinm">3</span><span onclick="r('*')" class="sciop">&#215;</span><span onclick="r('M-')" class="sciop">M-</span></div><div><span onclick="r(0)" class="scinm">0</span><span onclick="r('.')" class="scinm">.</span><span onclick="r('EXP')" class="sciop">EXP</span><span onclick="r('/')" class="sciop">&#247;</span><span onclick="r('MR')" class="sciop">MR</span></div><div><span onclick="r('+/-')" class="sciop">&#177;</span><span onclick="r('RND')" class="sciop">RND</span><span onclick="r('C')" class="scieq">C</span><span onclick="r('=')" class="scieq">=</span><span onclick="r('MC')" class="sciop">MC</span></div></div></td></tr><tr><td id="calfootnote">powered by <a href="http://www.calculator.net">calculator.net</a></td></tr></table>
<!--END OF SCIENTIFIC CALCULATOR CODE-->

<script type="text/javascript">

function main()
{
	var view = new View
	(
		ToolPaint.Name,
		[
			new ToolFileSave(),
			new ToolViewSize(new Coords(320, 240)),
			new ToolBrushSize(),
			new ToolColorPalette(),
			new ToolLayers(),
			new ToolPaint(),
			new ToolFill()
		]
	);

	document.body.appendChild(view.htmlElementBuild());		
}

// classes

function Color(name, systemColor)
{
	this.name = name;
	this.systemColor = systemColor;
}
{
	Color.Instances = new (function()
	{
		this.Black 	= new Color("Black", "#000000");
		this.Blue 	= new Color("Blue", "#0000ff");
		this.Cyan	= new Color("Cyan", "#00ffff");
		this.Gray	= new Color("Gray", "#808080");
		this.GrayDark	= new Color("GrayDark", "#404040");
		this.GrayLight 	= new Color("GrayLight", "#C0C0C0");
		this.Green	= new Color("Green", "00ff00");
		this.Orange	= new Color("Orange", "ff8000");
		this.Red 	= new Color("Red", "#ff0000");
		this.Violet	= new Color("Violet", "#ff00ff");
		this.White 	= new Color("White", "#ffffff");
		this.Yellow	= new Color("Yellow", "#ffff00");

		this._All =
		[
			this.Black,
			this.GrayDark,
			this.Gray,
			this.GrayLight,
			this.White,

			this.Red,
			this.Orange,
			this.Yellow,
			this.Green,
			this.Cyan,
			this.Blue,
			this.Violet
		];
	})();
}

function Coords(x, y)
{
	this.x = x;
	this.y = y;	
}
{
	Coords.prototype.clone = function()
	{
		return new Coords(this.x, this.y);
	}

	Coords.prototype.divide = function(other)
	{
		this.x /= other.x;
		this.y /= other.y;

		return this;
	}

	Coords.prototype.divideScalar = function(scalar)
	{
		this.x /= 2;
		this.y /= 2;

		return this;
	}

	Coords.prototype.multiply = function(other)
	{
		this.x *= other.x;
		this.y *= other.y;

		return this;
	}

	Coords.prototype.overwriteWith = function(other)
	{
		this.x = other.x;
		this.y = other.y;

		return this;
	}

	Coords.prototype.overwriteWithDimensions = function(x, y)
	{
		this.x = x;
		this.y = y;

		return this;
	}

	Coords.prototype.toString = function()
	{
		return "(" + this.x + "," + this.y + ")";
	}
}

function Tool()
{}
{
	Tool.processSelection = function(event)
	{
		var tool = event.target.parentTool;
		tool.parentView.toolSelected = tool;
	}
}

function ToolBrushSize()
{
	this.brushSizeSelected = 1;
}
{
	// constants

	ToolBrushSize.Name = "BrushSize";
	ToolBrushSize.prototype.name = ToolBrushSize.Name;

	// static methods

	ToolBrushSize.prototype.processBrushSizeChange = function(event)
	{
		var tool = event.target.parentTool;
		tool.brushSizeSelected = event.target.value;
	}

	// instance methods

	ToolBrushSize.prototype.htmlElementBuild = function()
	{		
		var tr = document.createElement("tr");

		var td = document.createElement("td");
		td.innerHTML = "Brush Size:";
		tr.appendChild(td);

		td = document.createElement("td");
		var numberBrushSize = document.createElement("input");
		numberBrushSize.type = "number";
		numberBrushSize.value = this.brushSizeSelected;
		numberBrushSize.style.width = "64px";
		numberBrushSize.onchange = this.processBrushSizeChange.bind(this);
		numberBrushSize.parentTool = this;
		td.appendChild(numberBrushSize);
		tr.appendChild(td);

		var returnValue = document.createElement("table");
		returnValue.appendChild(tr);

		return returnValue;	
	}
}

function ToolColorPalette()
{
	this.colorSelected = Color.Instances.Black;
}
{
	// constants

	ToolColorPalette.Name = "ColorPalette";
	ToolColorPalette.prototype.name = ToolColorPalette.Name;

	// instance methods

	// event handlers

	ToolColorPalette.prototype.processColorChange = function(event)
	{
		var tool = event.target.parentTool;
		tool.colorSelected = Color.Instances._All[event.target.selectedIndex];
	}

	// html

	ToolColorPalette.prototype.htmlElementBuild = function()
	{
		var tr = document.createElement("tr");

		var pForLabel = document.createElement("p");
		pForLabel.innerHTML = "Color:";
		var td = document.createElement("td");
		td.appendChild(pForLabel);
		tr.appendChild(td);

		td = document.createElement("td");
		var selectColor = document.createElement("select");
		for (var c = 0; c < Color.Instances._All.length; c++)
		{
			var color = Color.Instances._All[c];
			var optionForColor = document.createElement("option");
			optionForColor.text = color.name;
			selectColor.appendChild(optionForColor);
		}
		selectColor.onchange = this.processColorChange.bind(this);
		selectColor.parentTool = this;
		td.appendChild(selectColor);
		tr.appendChild(td);

		var returnValue = document.createElement("table");
		returnValue.appendChild(tr);

		return returnValue;	
	}
}

function ToolFileSave()
{
	this.fileNameToSaveAs = "Untitled.png";
}
{
	// constants

	ToolFileSave.Name = "FileSave";
	ToolFileSave.prototype.name = ToolFileSave.Name;

	// instance methods

	// event handlers

	ToolFileSave.prototype.processFileNameToSaveAsChange = function(event)
	{
		var tool = event.target.parentTool;
		tool.fileNameToSaveAs = event.target.value;
	}

	ToolFileSave.prototype.processSave = function(event)
	{
		var tool = event.target.parentTool;

		var canvas = document.getElementById("viewCanvas");

		var imageFromCanvasURL = canvas.toDataURL("image/png");

		var imageAsByteString = atob(imageFromCanvasURL.split(',')[1]);
		var imageAsArrayBuffer = new ArrayBuffer(imageAsByteString.length);
		var imageAsArrayUnsigned = new Uint8Array(imageAsArrayBuffer);
		for (var i = 0; i < imageAsByteString.length; i++) 
		{
			imageAsArrayUnsigned[i] = imageAsByteString.charCodeAt(i);
		}

		var imageAsBlob = new Blob([imageAsArrayBuffer], {type:'image/png'});

		var link = document.createElement("a");
		link.href = window.webkitURL.createObjectURL(imageAsBlob);
		link.download = tool.fileNameToSaveAs;
		link.click();
	}

	// html

	ToolFileSave.prototype.htmlElementBuild = function()
	{
		var tr = document.createElement("tr");

		var td = document.createElement("td");
		var buttonSave = document.createElement("button");
		buttonSave.onclick = this.processSave.bind(this);
		buttonSave.innerHTML = "Save As:";
		buttonSave.parentTool = this;
		td.appendChild(buttonSave);
		tr.appendChild(td);

		td = document.createElement("td");
		var textFileName = document.createElement("input");
		textFileName.value = "Untitled.png";
		textFileName.onchange = this.processFileNameToSaveAsChange.bind(this);
		textFileName.parentTool = this;
		td.appendChild(textFileName);
		tr.appendChild(td);

		var returnValue = document.createElement("table");

		returnValue.appendChild(tr);

		return returnValue;		
	}
}

function ToolFill()
{}
{
	// constants 

	ToolFill.Name = "Fill";
	ToolFill.prototype.name = ToolFill.Name;

	// instance methods

	ToolFill.prototype.drawRectangle = function(color, pos, size)
	{
		var graphics = this.parentView.graphics;
		graphics.fillStyle = color.systemColor;
		graphics.fillRect(pos.x, pos.y, size.x, size.y);
	}

	ToolFill.prototype.htmlElementBuild = function()
	{
		var returnValue = document.createElement("button");
		returnValue.parentTool = this;
		returnValue.innerHTML = "Fill";
		returnValue.onclick = Tool.processSelection;
		return returnValue;	
	}

	ToolFill.prototype.processMouseDown = function()
	{
		var toolLookup = this.parentView.toolLookup;

		this.drawRectangle
		(
			toolLookup[ToolColorPalette.Name].colorSelected, 
			new Coords(0, 0),
			toolLookup[ToolViewSize.Name].viewSizeInPixels
		);		
	}

	ToolFill.prototype.processMouseMove = function()
	{
		// do nothing
	}
}

function ToolLayers()
{
	this.layerIndexSelected = 0;
}
{
	// constants

	ToolLayers.Name = "Layers";
	ToolLayers.prototype.name = ToolLayers.Name;

	// instance methods

	// event handlers

	ToolLayers.prototype.processButtonLayerAddClicked = function(event)
	{
		var layersAll = this.parentView.layers;
		var layerNewIndex = layersAll.length;
		var layerNew = new ViewLayer("Layer" + layerNewIndex);
		layerNew.parentView = this.parentView;
		layerNew.htmlElementBuild();
		layersAll.push(layerNew);
		layersAll[layerNew.name] = layerNew;

		this.layerIndexSelected = layerNewIndex;

		this.htmlElementUpdate();
	}

	ToolLayers.prototype.processButtonLayerHideOrShowClicked = function(event)
	{
		var layerSelected = this.parentView.layerSelected();
		layerSelected.isVisible = (layerSelected.isVisible == false);
		this.htmlElementUpdate();
		this.parentView.htmlElementUpdate();
	}

	ToolLayers.prototype.processButtonLayerRemoveClicked = function(event)
	{
		var layerToRemove = this.parentView.layerSelected();

		var layersAll = this.parentView.layers;
		layersAll.splice(this.layerIndexSelected, 1);
		delete layersAll[layerToRemove.name];

		this.layerIndexSelected = 0;

		this.htmlElementUpdate();
		this.parentView.htmlElementUpdate();
	}

	ToolLayers.prototype.processLayerChange = function(event)
	{
		this.layerIndexSelected = event.srcElement.selectedIndex;
	}

	// html

	ToolLayers.prototype.htmlElementBuild = function()
	{
		var tr = document.createElement("tr");

		var pForLabel = document.createElement("p");
		pForLabel.innerHTML = "Layer:";
		var td = document.createElement("td");
		td.appendChild(pForLabel);
		tr.appendChild(td);

		td = document.createElement("td");
		var selectLayer = document.createElement("select");
		selectLayer.parentTool = this;
		selectLayer.onchange = this.processLayerChange.bind(this);
		this.selectLayer = selectLayer;
		
		td.appendChild(selectLayer);
		tr.appendChild(td);
		
		td = document.createElement("td");
		var buttonLayerAdd = document.createElement("button");
		buttonLayerAdd.innerHTML = "Add";
		buttonLayerAdd.onclick = this.processButtonLayerAddClicked.bind(this);
		td.appendChild(buttonLayerAdd);
		tr.appendChild(td);

		td = document.createElement("td");
		var buttonLayerDelete = document.createElement("button");
		buttonLayerDelete.innerHTML = "Remove";
		buttonLayerDelete.onclick = this.processButtonLayerRemoveClicked.bind(this);
		td.appendChild(buttonLayerDelete);
		tr.appendChild(td);

		td = document.createElement("td");
		var buttonLayerHideOrShow = document.createElement("button");
		buttonLayerHideOrShow.innerHTML = "Hide/Show";
		buttonLayerHideOrShow.onclick = this.processButtonLayerHideOrShowClicked.bind(this);
		td.appendChild(buttonLayerHideOrShow);
		tr.appendChild(td);
		
		var returnValue = document.createElement("table");
		returnValue.appendChild(tr);

		this.htmlElement = returnValue;

		this.htmlElementUpdate();

		return returnValue;	
	}

	ToolLayers.prototype.htmlElementUpdate = function()
	{
		this.selectLayer.innerHTML = "";

		var layersAll = this.parentView.layers;
		for (var c = 0; c < layersAll.length; c++)
		{
			var layer = layersAll[c];
			var optionForLayer = document.createElement("option");
			optionForLayer.text = layer.name;
			this.selectLayer.appendChild(optionForLayer);
		}

		this.selectLayer.selectedIndex = this.layerIndexSelected;
	}
}

function ToolPaint()
{}
{
	// constants

	ToolPaint.Name = "Paint";
	ToolPaint.prototype.name = ToolPaint.Name;

	// instance methods

	ToolPaint.prototype.drawLine = function(graphics, color, widthInPixels, startPos, endPos)
	{
		graphics.strokeStyle = color.systemColor;
		graphics.lineWidth = widthInPixels;
		graphics.lineCap = "round";
		graphics.beginPath();
		graphics.moveTo(startPos.x, startPos.y);
		graphics.lineTo(endPos.x, endPos.y);
		graphics.stroke();
	}

	// event handlers

	ToolPaint.prototype.processMouseDown = function()
	{
		// do nothing
	}

	ToolPaint.prototype.processMouseMove = function()
	{
		var toolLookup = this.parentView.toolLookup;

		this.drawLine
		(
			this.parentView.layerSelected().graphics,
			toolLookup[ToolColorPalette.Name].colorSelected, 
			toolLookup[ToolBrushSize.Name].brushSizeSelected,
			this.parentView.mousePosPrev, 
			this.parentView.mousePos
		);

		this.parentView.htmlElementUpdate();
	}

	// html

	ToolPaint.prototype.htmlElementBuild = function()
	{
		var returnValue = document.createElement("button");
		returnValue.parentTool = this;
		returnValue.innerHTML = this.name;
		returnValue.onclick = Tool.processSelection;
		return returnValue;	
	}
}

function ToolViewSize(viewSizeInPixels)
{
	this.viewSizeInPixels = viewSizeInPixels;
}
{
	// constants

	ToolViewSize.Name = "ViewSize";
	ToolViewSize.prototype.name = ToolViewSize.Name;

	// instance methods

	// event handlers

	ToolViewSize.prototype.processViewSizeChange = function(event)
	{
		var viewSizeInPixels = new Coords
		(
			parseInt(this.numberViewSizeX.value), 
			parseInt(this.numberViewSizeY.value)
		);	
		this.viewSizeInPixels = viewSizeInPixels;

		var layersAll = this.parentView.layers;

		for (var i = 0; i < layersAll.length; i++)
		{
			var layer = layersAll[i];
			var canvas = layer.canvas;

			var imageFromCanvasURL = canvas.toDataURL("image/png");
			var imageFromCanvas = document.createElement("img");
			imageFromCanvas.width = canvas.width;
			imageFromCanvas.height = canvas.height;	
	
			imageFromCanvas.parentLayer = layer;
			imageFromCanvas.onload = this.processViewSizeChange2.bind(this);

			imageFromCanvas.src = imageFromCanvasURL;

			canvas.width = viewSizeInPixels.x;
			canvas.height = viewSizeInPixels.y;
		}

		var canvas = this.parentView.htmlElementCanvas;
		canvas.width = viewSizeInPixels.x;
		canvas.height = viewSizeInPixels.y;
	}

	ToolViewSize.prototype.processViewSizeChange2 = function(event)	
	{
		var imageFromCanvas = event.target;
		var graphics = imageFromCanvas.parentLayer.graphics;

		graphics.drawImage
		(
			imageFromCanvas,
			0, 0, // source pos
			imageFromCanvas.width, imageFromCanvas.height, // source size
			0, 0, // destination pos
			imageFromCanvas.width, imageFromCanvas.height // destination size
		);

		this.parentView.htmlElementUpdate();
	}

	// html

	ToolViewSize.prototype.htmlElementBuild = function()
	{
		var tr = document.createElement("tr");

		var td = document.createElement("td");
		var button = document.createElement("button");
		button.onclick = this.processViewSizeChange.bind(this);
		button.innerHTML = "Change Size:";
		button.parentTool = this;
		td.appendChild(button);
		tr.appendChild(td);

		td = document.createElement("td");
		var numberViewSizeX = document.createElement("input");
		numberViewSizeX.type = "number";
		numberViewSizeX.value = this.viewSizeInPixels.x;
		numberViewSizeX.style.width = "64px";
		numberViewSizeX.parentTool = this;
		td.appendChild(numberViewSizeX);
		tr.appendChild(td);
		this.numberViewSizeX = numberViewSizeX;

		td = document.createElement("td");
		var numberViewSizeY = document.createElement("input");
		numberViewSizeY.type = "number";
		numberViewSizeY.value = this.viewSizeInPixels.y;
		numberViewSizeY.style.width = "64px";
		numberViewSizeY.parentTool = this;
		td.appendChild(numberViewSizeY);
		tr.appendChild(td);
		this.numberViewSizeY = numberViewSizeY;

		var returnValue = document.createElement("table");

		returnValue.appendChild(tr);

		return returnValue;		
	}
}

function View(toolNameToSelectInitial, tools)
{
	this.tools = tools;
	this.toolLookup = new Array();

	for (var t = 0; t < this.tools.length; t++)
	{
		var tool = this.tools[t];

		this.toolLookup[tool.name] = tool;

		tool.parentView = this;		
	}

	this.toolSelected = this.toolLookup[toolNameToSelectInitial];

	this.layers = 
	[
		new ViewLayer("Layer0"),
	];

	for (var i = 0; i < this.layers.length; i++)
	{
		var layer = this.layers[i];
		this.layers[layer.name] = layer;
		layer.parentView = this;
		layer.htmlElementBuild();
	}
}
{
	// static methods

	View.imageURLForAlphaZeroBuild = function()
	{
		var imageSizeInPixels = new Coords(32, 32);
		var imageSizeInPixelsHalf = imageSizeInPixels.clone().divideScalar(2);

		var canvas = document.createElement("canvas");
		canvas.width = imageSizeInPixels.x;
		canvas.height = imageSizeInPixels.y;

		var graphicsForCanvas = canvas.getContext("2d");

		graphicsForCanvas.fillStyle = Color.Instances.Gray.systemColor;
		graphicsForCanvas.fillRect(0, 0, imageSizeInPixels.x, imageSizeInPixels.y);		
		graphicsForCanvas.fillStyle = Color.Instances.GrayDark.systemColor;
		graphicsForCanvas.fillRect(0, 0, imageSizeInPixelsHalf.x, imageSizeInPixelsHalf.y);		
		graphicsForCanvas.fillRect
		(
			imageSizeInPixelsHalf.x, 
			imageSizeInPixelsHalf.y, 
			imageSizeInPixelsHalf.x, 
			imageSizeInPixelsHalf.y
		);

		var imageFromCanvasURL = canvas.toDataURL("image/png");

		return imageFromCanvasURL;
	}

	// instance methods

	View.prototype.layerSelected = function()
	{
		var layerIndexSelected = this.toolLookup[ToolLayers.Name].layerIndexSelected;
		var returnValue = this.layers[layerIndexSelected]; 
		return returnValue;
	}

	View.prototype.sizeInPixels = function()
	{
		var returnValue = this.toolLookup[ToolViewSize.Name].viewSizeInPixels;
		return returnValue;
	}

	// event handlers

	View.prototype.processMouseDown = function(event)
	{		
		event.preventDefault(); // otherwise the cursor changes

		var boundingClientRect = event.target.getBoundingClientRect();
		this.mousePos.overwriteWithDimensions
		(
			event.clientX - boundingClientRect.left,
			event.clientY - boundingClientRect.top
		);
		this.mousePosPrev.overwriteWith(this.mousePos);
		this.isMouseDown = true;
		this.toolSelected.processMouseDown();
	}

	View.prototype.processMouseOver = function(event)
	{
		// do nothing
	}

	View.prototype.processMouseOut = function(event)
	{
		this.isMouseDown = false;		
	}

	View.prototype.processMouseMove = function(event)
	{
		if (this.isMouseDown == true)
		{
			this.mousePosPrev.overwriteWith(this.mousePos);
			var boundingClientRect = event.target.getBoundingClientRect();
			this.mousePos.overwriteWithDimensions
			(
				event.clientX - boundingClientRect.left,
				event.clientY - boundingClientRect.top
			);
			this.toolSelected.processMouseMove();
		}
	}	

	View.prototype.processMouseUp = function(event)
	{
		this.isMouseDown = false;
	}

	// html

	View.prototype.htmlElementBuild = function()
	{
		this.isMouseDown = false;
		this.mousePos = new Coords(0, 0);
		this.mousePosPrev = new Coords(0, 0);

		var sizeInPixels = this.toolLookup[ToolViewSize.Name].viewSizeInPixels;

		var canvas		= document.createElement("canvas");
		canvas.id		= "viewCanvas";
		canvas.width		= sizeInPixels.x;
		canvas.height		= sizeInPixels.y;
		canvas.style.cursor 	= "crosshair";
		canvas.style.backgroundImage = "url('" + View.imageURLForAlphaZeroBuild() + "')";
		canvas.parentView = this;

		this.htmlElementCanvas = canvas;
		this.graphics = canvas.getContext("2d");

		canvas.onmousedown = this.processMouseDown.bind(this);
		canvas.onmousemove = this.processMouseMove.bind(this);
		canvas.onmouseout = this.processMouseOut.bind(this);
		canvas.onmouseover = this.processMouseOver.bind(this);
		canvas.onmouseup = this.processMouseUp.bind(this);

		var divTools = document.createElement("div");

		for (var t = 0; t < this.tools.length; t++)
		{
			var tool = this.tools[t];

			divTools.appendChild(tool.htmlElementBuild());
		}

		var returnValue = document.createElement("div");
		returnValue.appendChild(canvas);
		returnValue.appendChild(divTools);

		return returnValue;
	}

	View.prototype.htmlElementUpdate = function()
	{
		var sizeInPixels = this.sizeInPixels();
		this.graphics.clearRect(0, 0, sizeInPixels.x, sizeInPixels.y);

		for (var i = 0; i < this.layers.length; i++)
		{
			var layer = this.layers[i];
			if (layer.isVisible == true)
			{
				var canvasForLayer = layer.canvas;
				this.graphics.drawImage(canvasForLayer, 0, 0);
			}
		}
	}
}

function ViewLayer(name)
{
	this.name = name;
	this.isVisible = true;
}
{
	ViewLayer.prototype.htmlElementBuild = function()
	{
		var sizeInPixels = this.parentView.sizeInPixels();

		var canvas = document.createElement("canvas");
		canvas.id = "canvasLayer" + this.name;
		canvas.width = sizeInPixels.x;
		canvas.height = sizeInPixels.y;

		this.canvas = canvas;
		this.graphics = canvas.getContext("2d");

		return canvas;
	}
}

// run

main();

</script>
</body>
</html>

</body>  
</html>  
	</body>
</html>
